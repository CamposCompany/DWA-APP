<div
  class="container-reset-password h-100 d-flex flex-column align-items-center"
>
  <div class="header-container d-flex align-items-center w-100">
    <img
      *ngIf="currentStep < 3"
      [routerLink]="currentStep === 1 ? '/login' : null"
      class="header-button"
      src="assets/images/back-button.png"
      alt="Voltar"
      (click)="handleBackButtonClick()"
      aria-label="Voltar"
    />
    <h1 class="text-center w-100">Recuperar senha</h1>
    <img
      *ngIf="currentStep > 1"
      routerLink="/login"
      class="header-button"
      src="assets/images/home-button.png"
      alt="Home"
      aria-label="Home"
    />
  </div>

  <div class="w-100 h-100 d-flex flex-column align-items-center">
    <ng-container [ngTemplateOutlet]="getCurrentStepTemplate()"></ng-container>
  </div>

  <ng-template #firstStepTemplate>
    <img class="logo" src="assets/images/logo/dwa-logo.svg" alt="Logo" />
    <form
      [formGroup]="firstStepForm"
      class="w-100 h-100 d-flex flex-column justify-content-between"
    >
      <app-input
        label="CPF"
        mask="000.000.000-00"
        [control]="$any(firstStepForm).controls['document']"
      ></app-input>
      <p
        class="error-message mb-0"
        *ngIf="currentStep === 1 && (errorMessage$ | async) as errorMessage"
      >
        {{ errorMessage }}
      </p>
      <app-button
        class="mt-3"
        label="Pr贸ximo"
        (clicked)="onSubmit()"
      ></app-button>
    </form>
  </ng-template>

  <ng-template #secondStepTemplate>
    <h3 class="mb-4 text-center">
      Enviamos um c贸digo por SMS para {{ userPhone$ | async }}
    </h3>
    <form
      [formGroup]="secondStepForm"
      class="w-100 h-100 d-flex flex-column justify-content-between"
    >
      <app-input
        label="Digite o c贸digo"
        mask="00000"
        [control]="$any(secondStepForm).controls['code']"
      ></app-input>
      <p
        class="error-message mt-3 mb-0"
        *ngIf="errorMessage$ | async as errorMessage"
      >
        {{ errorMessage }}
      </p>
      <app-button
        class="mt-3"
        label="Pr贸ximo"
        (clicked)="onSubmit()"
      ></app-button>
    </form>
  </ng-template>

  <ng-template #thirdStepTemplate>
    <h3 class="mb-5">Digite e confirme sua nova senha</h3>
    <form
      [formGroup]="thirdStepForm"
      class="w-100 h-100 d-flex flex-column justify-content-between"
    >
      <div class="d-flex flex-column gap-3">
        <app-input
          label="Digite sua nova senha"
          type="password"
          [control]="$any(thirdStepForm).controls['password']"
        ></app-input>
        <app-input
          label="Confirme nova senha"
          type="password"
          [control]="$any(thirdStepForm).controls['password_confirmation']"
        ></app-input>
        <p
          *ngIf="
            thirdStepForm.invalid &&
            thirdStepForm.touched &&
            thirdStepForm.errors
          "
          class="error-message"
        >
          {{ thirdStepForm.errors | onlyOneError }}
        </p>
        <p class="error-message" *ngIf="errorMessage$ | async as error">
          {{ error }}
        </p>
      </div>
      <app-button
        class="mt-4"
        text="Salvar"
        (clicked)="onSubmit()"
      ></app-button>
    </form>
  </ng-template>
</div>

<app-loading></app-loading>
