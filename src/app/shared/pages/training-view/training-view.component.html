<div *ngIf="training$ | async as training">
  <app-header title="Treino"></app-header>
  <div class="d-flex w-100 justify-content-center">
    <div
      class="d-flex flex-column justify-content-between view-container w-100"
    >
      <div class="d-flex justify-content-between">
        <div class="d-flex flex-column">
          <h3>{{ training.name.toLocaleUpperCase() }}</h3>
          <p class="mt-3">{{ training.description }}</p>
          <div *ngIf="showTrainingTime$ | async" class="mt-3">
            <h4>Tempo de treino: {{ elapsedTime$ | async }}</h4>
          </div>
        </div>

        <div
          class="d-flex align-items-end gap-1"
          *ngIf="training.last_duration"
        >
          <i class="fas fa-solid fa-clock"></i>
          <p>{{ formatDuration(training.last_duration) }}</p>
        </div>
      </div>

      <div class="mt-3" *ngIf="hasUserTraining(training.exercises)">
        <div
          *ngIf="isOtherTrainingActive$ | async"
          class="alert alert-warning text-center"
        >
          Outro treino em andamento
        </div>

        <ng-container *ngIf="!(isOtherTrainingActive$ | async)">
          <ng-container
            *ngIf="!(isTrainingCompleted$ | async); else completedButton"
          >
            <app-button
              *ngIf="!(isTrainingStarted$ | async) && !isAdmin"
              label="Começar"
              [icon]="'assets/icons/training-view/start.svg'"
              buttonClass="btn-primary w-100"
              (clicked)="onTrainingStart()"
            ></app-button>

            <div
              *ngIf="isTrainingStarted$ | async"
              class="d-flex flex-column gap-2"
            >
              <div class="d-flex gap-2 align-items-center">
                <app-button
                  [label]="(isPaused$ | async) ? 'Voltar' : 'Pausar'"
                  [icon]="
                    (isPaused$ | async)
                      ? 'assets/icons/training-view/start.svg'
                      : 'assets/icons/training-view/pause.svg'
                  "
                  buttonClass="btn-secondary"
                  class="w-50"
                  (clicked)="onTogglePause()"
                ></app-button>
                <app-button
                  label="Reiniciar"
                  [icon]="'assets/icons/training-view/restart.svg'"
                  class="w-50"
                  (clicked)="onTrainingRestart()"
                ></app-button>
              </div>

              <app-button
                label="Concluído"
                [icon]="'assets/icons/done.svg'"
                buttonClass="btn-success"
                class="w-100"
                [disabled]="!(isAllExercisesCompleted() | async)"
                (clicked)="onTrainingComplete()"
              ></app-button>
            </div>
          </ng-container>

          <ng-template #completedButton>
            <app-button
              label="Concluído"
              [icon]="'assets/icons/done.svg'"
              buttonClass="btn-success w-100"
              [disabled]="true"
            ></app-button>
          </ng-template>
        </ng-container>
      </div>
    </div>
  </div>
  <h3 class="mt-5 mb-3">Exercícios</h3>
  <ng-container *ngIf="training.exercises; else noExercises">
    <ng-container
      *ngIf="hasUserTraining(training.exercises); else regularExercises"
    >
      <div class="exercises-container">
        <app-user-card-exercise
          *ngFor="let exercise of training.exercises"
          [exercise]="exercise"
          [isAdmin]="isAdmin"
          [isTrainingStarted]="(isTrainingStarted$ | async) === true"
          [isTrainingPaused]="(isPaused$ | async) === true"
          [isTrainingCompleted]="training.completed"
          [isOtherTrainingActive]="(isOtherTrainingActive$ | async) === true"
          [isCompleted]="(isCompleted(exercise.id) | async) === true"
          (exerciseToggled)="onExerciseCompleted($event)"
          (exerciseClicked)="onExerciseClick($event)"
        ></app-user-card-exercise>
      </div>
    </ng-container>

    <ng-template #regularExercises>
      <div class="exercises-container">
        <app-card-exercise
          *ngFor="let exercise of training.exercises"
          [exercise]="exercise"
          (exerciseClicked)="onExerciseClick($event)"
        ></app-card-exercise>
      </div>
    </ng-template>
  </ng-container>

  <ng-template #noExercises>
    <p class="text-center no-exercises">Não há exercícios disponíveis</p>
  </ng-template>
</div>
